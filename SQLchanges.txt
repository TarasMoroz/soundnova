
ALTER TABLE `category` ADD `publish` TINYINT( 1 ) NOT NULL COMMENT '1,0' AFTER `seo_text`;
UPDATE `category` SET `publish`= 1;
ALTER TABLE `site_review` ADD `title` VARCHAR( 256 ) NOT NULL AFTER `id_video`;


CREATE TABLE IF NOT EXISTS `cart` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_user` int(11) NOT NULL,
  `json_cart` varchar(6000) NOT NULL,
  `fp` varchar(256) NOT NULL COMMENT 'fingerprint',
  `hash` varchar(512) NOT NULL COMMENT 'unique cart hash',
  `ip` varchar(32) NOT NULL,
  `ua` varchar(256) NOT NULL COMMENT 'user agent',
  `referer` varchar(256) NOT NULL,
  `dt_create` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dt_update` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

ALTER TABLE `cart` ADD `id_coupon` INT( 11 ) NOT NULL AFTER `id_user`;

CREATE TABLE IF NOT EXISTS `cart_item` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_product` int(11) NOT NULL,
  `id_variant` int(11) NOT NULL,
  `dt_create` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dt_update` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;


ALTER TABLE `cart_item` ADD `id_cart` INT( 11 ) NOT NULL AFTER `id`;

ALTER TABLE `cart_item` ADD UNIQUE (
`id_cart` ,
`id_product` ,
`id_variant`
);


-- --------------------------------------------------------

CREATE TABLE IF NOT EXISTS `cart_coupon` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `code` varchar(64) NOT NULL COMMENT 'coupon code',
  `value` int(8) NOT NULL,
  `is_percent` tinyint(1) NOT NULL COMMENT '1,0 - percent or direct',
  `publish` tinyint(1) NOT NULL COMMENT '1,0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

ALTER TABLE `cart_coupon` ADD `dt_create` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;

ALTER TABLE `cart_coupon` ADD `cnt_applies` INT( 8 ) NOT NULL COMMENT 'how many times used' AFTER `is_percent`;

-- ---------------------------------------------------------

DROP TABLE customer;

CREATE TABLE IF NOT EXISTS `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `password` varchar(64) NOT NULL,
  `firstname` varchar(64) NOT NULL,
  `lastname` varchar(64) NOT NULL,
  `displayname` varchar(64) NOT NULL,
  `dt_register` datetime NOT NULL,
  `dt_last_login` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;

ALTER TABLE `user` ADD `email` VARCHAR( 64 ) NOT NULL AFTER `id`;
ALTER TABLE `user` ADD `email_active` TINYINT( 1 ) NOT NULL COMMENT '1,0' AFTER `email`;
ALTER TABLE `user` ADD `email_activation_code` INT( 10 ) NOT NULL AFTER `email_active`;

ALTER TABLE `user` ADD `g_uid` VARCHAR( 128 ) NOT NULL COMMENT 'g login' AFTER `dt_last_login`;
ALTER TABLE `user` ADD `g_email` VARCHAR( 64 ) NOT NULL COMMENT 'g email' AFTER `g_uid`;
ALTER TABLE `user` ADD `picture` VARCHAR( 256 ) NOT NULL COMMENT 'profile picture' AFTER `password`;

CREATE TABLE IF NOT EXISTS `user_soc` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_user` int(11) NOT NULL,
  `provider` varchar(64) NOT NULL COMMENT 'FB, Google ...',
  `identity` varchar(256) NOT NULL,
  `email` varchar(256) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;